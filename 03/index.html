<meta charset="UTF-8">
<html>
  <head>
    <style>
      html, body { 
        background-color:#000;
        margin: 0;
        padding: 0;
        height: 100%;
      }
    </style>
    <script src=https://threejs.org/build/three.min.js type=text/javascript></script>
    <script src=https://threejs.org/examples/js/controls/TrackballControls.js type=text/javascript></script>
    <script>
      window.onload = function() {
        scene = new THREE.Scene();

        camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 1, 10000 );
        camera.position.set( 0, 0, 100 );
 
        renderer = new THREE.WebGLRenderer();
        renderer.setSize( window.innerWidth, window.innerHeight );
        document.body.appendChild( renderer.domElement );
	renderer.domElement.onclick = 
		function(e) {
			// qiocl amd dirty function to generate a random color
			function gVal() {
				var min = 0, max = 16777215;
				return Math.round(Math.random() * (max - min) + min);
			}

			// just create new geometries here as opposed to making them on the fly
			MESH_TYPE = [
				new THREE.BoxBufferGeometry(20, 20, 20),
				new THREE.TorusKnotBufferGeometry(20, 20, 20, 20),
				new THREE.SphereBufferGeometry(20, 20, 20),
				new THREE.OctahedronBufferGeometry(20),
				new THREE.ConeBufferGeometry(20, 20),
				new THREE.RingBufferGeometry(20, 20, 20)
			];

			if (!e.shiftKey) {
				e.preventDefault();
			}

			console.log("Yay! We clicked!");

			pixel_coords = new THREE.Vector2(e.clientX, e.clientY);
			console.log("Pixel Coords: ", pixel_coords);

			vp_coords = new THREE.Vector2((pixel_coords.x / window.innerWidth) * 2 - 1,
							-(pixel_coords.y / window.innerHeight) * 2 + 1)

			console.log("Viewport coords: ", vp_coords);

			vp_coords_near = new THREE.Vector3(vp_coords.x, vp_coords.y, 0);
			console.log(vp_coords_near);

			raycaster = new THREE.Raycaster();
			raycaster.setFromCamera(vp_coords_near, camera);
			intersects = raycaster.intersectObject(invisible_plane);

			first_intersection = intersects[0];

			console.log("3D Point: ", first_intersection);

			// prevents errors in the console
			if (first_intersection == null)
				return;

			// move cube to new 3D position
			//cube.position.set(first_intersection.point.x,
			//			first_intersection.point.y,
			//			first_intersection.point.z);

			// add new geometry, material with random color and mesh
			var g = MESH_TYPE[Math.floor(Math.random() * MESH_TYPE.length)];
			var m = new THREE.MeshStandardMaterial({ color: gVal() });
			var randMesh = new THREE.Mesh(g, m);

			scene.add(randMesh);
			randMesh.position.set(first_intersection.point.x,
						first_intersection.point.y,
						first_intersection.point.z);
		};

        ambientLight = new THREE.AmbientLight();
        scene.add( ambientLight );

        light = new THREE.DirectionalLight( 0xffffff, 5.0 );
        light.position.set( 10, 100, 10 );
        scene.add( light );

        geometry = new THREE.BoxBufferGeometry( 20, 20, 20 );
        material = new THREE.MeshStandardMaterial({ color: 0xffffff });
        cube = new THREE.Mesh( geometry, material );

	// add invisible plane
	geometry = new THREE.PlaneBufferGeometry(10000, 10000);
	material = new THREE.MeshStandardMaterial( { visible: false } );

	invisible_plane = new THREE.Mesh(geometry, material);

	scene.add(invisible_plane);

        scene.add(cube);
        controls = new THREE.TrackballControls( camera );
        animate();
      };

      function animate() {
        requestAnimationFrame( animate );
 

        controls.update();

        renderer.render( scene, camera );

 

      };

    </script>

  </head>

  <body></body>

</html>
